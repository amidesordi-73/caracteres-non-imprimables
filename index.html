<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Entraînement Word — Caractères non imprimables (¶)</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827ee; --ink:#e5e7eb;
      --muted:#9ca3af; --accent:#8b5cf6; --accent-2:#22d3ee;
      --ok:#10b981; --ko:#ef4444; --card:#1f2937;
    }
    body{
      margin:0;
      background:radial-gradient(1200px 800px at 10% -10%, #1e293b, transparent),
                 radial-gradient(900px 600px at 110% 10%, #111827, transparent),
                 linear-gradient(180deg, #0b1020, #0b0f1a);
      color:var(--ink); font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif;
    }
    .container{max-width:1100px;margin:40px auto;padding:0 20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .title{font-size:clamp(20px,3vw,36px);font-weight:800;}
    .badge{font-size:12px;color:#0b1020;background:linear-gradient(90deg,var(--accent),var(--accent-2));
      padding:6px 10px;border-radius:999px;font-weight:700}
    .panel{background:linear-gradient(180deg,var(--panel),#0b1220);
      border:1px solid #1f2a44;border-radius:18px;padding:20px}
    nav.tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{background:#111827;border:1px solid #1f2a44;color:var(--ink);
      padding:10px 14px;border-radius:12px;cursor:pointer}
    .tab[aria-selected="true"]{outline:2px solid var(--accent);color:white}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .card{background:linear-gradient(180deg,var(--card),#111827);
      border:1px solid #1f2a44;border-radius:16px;padding:16px}
    .muted{color:var(--muted)}
    .drag{user-select:none;border:1px dashed #334155;color:#e2e8f0;border-radius:12px;
      padding:12px;font-size:24px;font-weight:800;background:#0b1220;cursor:grab}
    .drop,#dragPool{min-height:62px;border:1px dashed #334155;border-radius:12px;padding:10px;background:#0b1220}
    .drop.hover{outline:2px solid var(--accent)}
    .row{display:grid;grid-template-columns:1fr 220px;gap:10px;align-items:center}
    .btn{border:none;cursor:pointer;color:#0b1020;background:linear-gradient(90deg,var(--accent),var(--accent-2));
      padding:10px 14px;border-radius:12px;font-weight:800}
    .btn.secondary{background:transparent;color:var(--ink);border:1px solid #2b3656}
    .kbd{font-family:monospace;background:#0b1220;border:1px solid #1f2a44;color:#e5e7eb;
      border-radius:8px;padding:2px 6px}
    .result{font-weight:800}
    #editor{min-height:220px;max-height:320px;overflow:auto;border:2px dashed #374151;border-radius:14px;padding:12px;
      background:#0b1220;white-space:pre-wrap;word-break:break-word}
    .mark{font-weight:800;font-size:1em;display:inline-block;pointer-events:none;user-select:none}
    .mark.paragraph{color:#f59e0b}.mark.linebreak{color:#22d3ee}.mark.tab{color:#60a5fa}
    .mark.space{color:#a78bfa}.mark.nbsp{color:#34d399}
    table{width:100%} th,td{padding:10px;border-bottom:1px solid #1f2a44;text-align:left}
    th{color:#cbd5e1}
    input[type="number"]{background:#0b1220;border:1px solid #1f2a44;color:var(--ink);
      border-radius:10px;padding:6px;width:100%}
    #sample{min-height:120px;max-height:280px;overflow:auto;padding:12px;border:1px solid #1f2a44;border-radius:12px;
      background:#0b1220;line-height:1.6;margin-top:10px}
    #variantInfo{font-size:14px;color:var(--muted);margin-top:6px}
    footer{margin:26px 0 10px;color:#94a3b8;display:flex;justify-content:space-between;flex-wrap:wrap}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <div class="title">Entraînement — Caractères non imprimables Word <span aria-hidden>¶</span></div>
      <div class="muted">Associer • Appliquer • Repérer</div>
    </div>
    <span class="badge">APF • Bureautique</span>
  </header>

  <div class="panel">
    <nav class="tabs">
      <button class="tab" aria-selected="true" aria-controls="p1">Exercice 1 : Associer</button>
      <button class="tab" aria-selected="false" aria-controls="p2">Exercice 2 : Appliquer</button>
      <button class="tab" aria-selected="false" aria-controls="p3">Exercice 3 : Repérer</button>
    </nav>

    <!-- EX1 -->
    <section id="p1" style="margin-top:16px">
      <div class="grid">
        <div class="card">
          <h3>Symboles</h3>
          <div id="dragPool">
            <div class="drag" draggable="true" data-key="paragraph">¶</div>
            <div class="drag" draggable="true" data-key="linebreak">↵</div>
            <div class="drag" draggable="true" data-key="tab">→</div>
            <div class="drag" draggable="true" data-key="space">·</div>
            <div class="drag" draggable="true" data-key="nbsp">°</div>
          </div>
        </div>
        <div class="card">
          <h3>Associer : faire glisser le symbole dans la bonne case.</h3>
          <div class="row"><div>Saut de paragraphe</div><div class="drop" data-accept="paragraph"></div></div>
          <div class="row"><div>Saut de ligne</div><div class="drop" data-accept="linebreak"></div></div>
          <div class="row"><div>Tabulation</div><div class="drop" data-accept="tab"></div></div>
          <div class="row"><div>Espace normal</div><div class="drop" data-accept="space"></div></div>
          <div class="row"><div>Espace insécable</div><div class="drop" data-accept="nbsp"></div></div>
          <button class="btn" id="check1">Valider</button>
          <button class="btn secondary" id="reset1">Réinitialiser</button>
          <div id="result1" class="result"></div>
        </div>
      </div>
    </section>

    <!-- EX2 -->
    <section id="p2" hidden style="margin-top:16px">
      <div class="card">
        <h3>Texte à modifier : ajoutez les symboles dans le texte en suivant les consignes.</h3>
        <ol class="muted">
          <li>Après « Titre de la note » : ¶ (<span class="kbd">Entrée</span>)</li>
          <li>Après « Objectifs : » : ↵ (<span class="kbd">Shift</span>+<span class="kbd">Entrée</span>)</li>
          <li>Avant « • Préparer la salle » : → (<span class="kbd">Tab</span>)</li>
          <li>Dans « RDV à 14 h 30 » : ° entre 14 et h (<span class="kbd">Ctrl</span>+<span class="kbd">Shift</span>+<span class="kbd">Espace</span> / <span class="kbd">Alt</span>+<span class="kbd">Espace</span>)</li>
          <li>Dans « Merci! » : · avant ! (<span class="kbd">Espace</span>)</li>
        </ol>
        <div class="toolbar" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
          <button class="btn secondary" id="reset2">Réinitialiser</button>
          <button class="btn secondary" id="example2">Exemple</button>
          <button class="btn" id="check2">Valider</button>
          <div id="result2" class="result"></div>
        </div>
        <div id="editor" contenteditable="true"></div>
      </div>
    </section>

    <!-- EX3 -->
    <section id="p3" hidden style="margin-top:16px">
      <div class="grid">
        <div class="card">
          <h3>Texte aléatoire</h3>
          <button class="btn secondary" id="regen">Nouveau texte</button>
          <div id="variantInfo"></div>
          <div id="sample"></div>
        </div>
        <div class="card">
          <h3>Questions : combien comptez-vous de symboles ?</h3>
          <table>
            <tr><td>¶</td><td><input type="number" id="q_paragraph"></td></tr>
            <tr><td>↵</td><td><input type="number" id="q_linebreak"></td></tr>
            <tr><td>→</td><td><input type="number" id="q_tab"></td></tr>
            <tr><td>·</td><td><input type="number" id="q_space"></td></tr>
            <tr><td>°</td><td><input type="number" id="q_nbsp"></td></tr>
          </table>
          <button class="btn" id="check3">Valider</button>
          <div id="result3" class="result"></div>
        </div>
      </div>
    </section>
  </div>

  <footer>
© <a href="https://www.avenirpro-formations.com" target="_blank">Avenir Pro Formations</a> — Mini-site pédagogique
   <a href="https://www.amidesordi.com" target="_blank">www.amidesordi.com</a>

  </footer>
</div>

<script>
// Tabs
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(t=>t.setAttribute('aria-selected','false'));
    document.querySelectorAll('section').forEach(p=>p.hidden=true);
    btn.setAttribute('aria-selected','true');
    document.getElementById(btn.getAttribute('aria-controls')).hidden=false;
  });
});

// EX1
const pool=document.getElementById('dragPool');
const drops=document.querySelectorAll('.drop');
function makeDroppable(zone){
  zone.addEventListener('dragover', e=>{e.preventDefault(); zone.classList.add('hover')});
  zone.addEventListener('dragleave', ()=>zone.classList.remove('hover'));
  zone.addEventListener('drop', e=>{
    e.preventDefault(); zone.classList.remove('hover');
    const key=e.dataTransfer.getData('text/plain');
    const el=document.querySelector(`.drag[data-key="${key}"]`);
    if(!el) return;
    if(zone!==pool) zone.innerHTML='';
    zone.appendChild(el);
  });
}
document.querySelectorAll('.drag').forEach(d=>{
  d.addEventListener('dragstart', e=>{e.dataTransfer.setData('text/plain', d.dataset.key); d.style.opacity=.6});
  d.addEventListener('dragend', ()=>d.style.opacity=1);
});
makeDroppable(pool); drops.forEach(makeDroppable);
document.getElementById('check1').onclick=()=>{
  let ok=0; drops.forEach(z=>{const c=z.querySelector('.drag'); if(c&&c.dataset.key===z.dataset.accept) ok++});
  const r=document.getElementById('result1');
  r.textContent=ok===drops.length?`Parfait (${ok}/5)`:`Encore ${5-ok} à corriger (${ok}/5)`;
  r.style.color=ok===drops.length?'var(--ok)':'var(--ko)';
};
document.getElementById('reset1').onclick=()=>{
  drops.forEach(z=>{const c=z.querySelector('.drag'); if(c) pool.appendChild(c); z.innerHTML=''});
  document.getElementById('result1').textContent='';
};

// EX2 — insertion des marques au clavier
const editor=document.getElementById('editor');
const result2=document.getElementById('result2');

function loadInitialEx2(){
  editor.innerHTML="Titre de la note<br>Objectifs :<br>• Préparer la salle<br>RDV à 14 h 30<br>Merci!";
  result2.textContent='';
  result2.removeAttribute('style');
}
loadInitialEx2();

function insertMark(markClass, char){
  const span=document.createElement('span');
  span.textContent=char;
  span.className=`mark ${markClass}`;
  span.dataset.kind=markClass;
  span.setAttribute('draggable','false');
  placeNodeAtCaret(span);
}
function placeNodeAtCaret(node){
  const sel=window.getSelection();
  if(!sel || !sel.rangeCount){ editor.appendChild(node); return; }
  const range=sel.getRangeAt(0);
  range.deleteContents();
  range.insertNode(node);
  range.setStartAfter(node);
  range.setEndAfter(node);
  sel.removeAllRanges(); sel.addRange(range);
}

// Interception clavier pour empêcher les vrais retours/espaces et insérer les symboles
editor.addEventListener('keydown', (e)=>{
  // Shift+Enter => ↵
  if(e.key==='Enter' && e.shiftKey){ e.preventDefault(); insertMark('linebreak','↵'); return; }
  // Enter => ¶
  if(e.key==='Enter'){ e.preventDefault(); insertMark('paragraph','¶'); return; }
  // Tab => →
  if(e.key==='Tab'){ e.preventDefault(); insertMark('tab','→'); return; }
  // NBSP => °
  if( (e.ctrlKey && e.shiftKey && (e.code==='Space' || e.key===' ')) || (e.altKey && (e.code==='Space' || e.key===' ')) ){
    e.preventDefault(); insertMark('nbsp','°'); return;
  }
  // Espace normal => ·
  if(e.key===' '){ e.preventDefault(); insertMark('space','·'); return; }
});

// Boutons Ex2
document.getElementById('reset2').onclick=loadInitialEx2;
document.getElementById('example2').onclick=()=>{
  editor.innerHTML='Titre de la note<span class="mark paragraph" data-kind="paragraph">¶</span><br>'+
                   'Objectifs :<span class="mark linebreak" data-kind="linebreak">↵</span><br>'+
                   '<span class="mark tab" data-kind="tab">→</span>• Préparer la salle<br>'+
                   'RDV à 14 <span class="mark nbsp" data-kind="nbsp">°</span>h 30<br>'+
                   'Merci<span class="mark space" data-kind="space">·</span>!';
};
document.getElementById('check2').onclick=()=>{
  const html=editor.innerHTML;
  const ok1=/Titre[^<]*<span[^>]*class="mark paragraph"[^>]*>¶<\/span>/.test(html);
  const ok2=/Objectifs[^<]*<span[^>]*class="mark linebreak"[^>]*>↵<\/span>/.test(html);
  const ok3=/<span[^>]*class="mark tab"[^>]*>→<\/span>•\s*Préparer/.test(html);
  const ok4=/14[^<]*<span[^>]*class="mark nbsp"[^>]*>°<\/span>\s*h 30/.test(html);
  const ok5=/Merci[^<]*<span[^>]*class="mark space"[^>]*>·<\/span>!/.test(html);
  const ok=[ok1,ok2,ok3,ok4,ok5].filter(Boolean).length;
  result2.textContent = ok===5 ? "Parfait (5/5)" : `${ok}/5 correct`;
  result2.style.color = ok===5 ? 'var(--ok)' : 'var(--ko)';
};

// EX3 (10 variantes, compteur, sans répétition)
const sample=document.getElementById('sample');
const info=document.getElementById('variantInfo');
let sampleStats={paragraph:0,linebreak:0,tab:0,space:0,nbsp:0};
let usedVariants=[];
function randomSample(){
  const variants=[
    "Mme°Dupont·organise·une·réunion↵RDV·à·14·h°30·→·Salle·B¶Merci·de·venir·avec·votre·PC¶",
    "RDV·à·9°h·15·→·Salle·A↵Liste·des·participants¶Merci·pour·votre·ponctualité¶",
    "Rapport·final·→·à·envoyer·avant·16°h·00↵Merci·de·relire·le·document¶",
    "Formation·Word·→·Salle·C↵Mme°Martin·sera·présente·à·10°h·45¶Merci·d’apporter·vos·notes¶",
    "Le·comité·se·réunit↵Lieu·:·Salle·D¶Ordre·du·jour·envoyé·par·mail¶",
    "Attention·:·fin·des·inscriptions↵Date·limite·:·12°h·00¶Contact·:·Mme·Durand¶",
    "RDV·médical·à·15°h·20→Salle·101¶Merci·de·vous·présenter·à·l’accueil¶",
    "Cours·Excel·→Salle·Informatique↵Durée·:·2·heures¶Pause·prévue·à·10°h·30¶",
    "Assemblée·générale↵Ouverture·à·18°h·00¶Clôture·prévue·vers·20°h·30¶",
    "Merci·de·ne·pas·oublier·vos·documents→Salle·Réunion¶Accueil·à·9°h·00¶"
  ];
  if(usedVariants.length===variants.length){usedVariants=[];} // reset après avoir tout vu
  let idx;
  do{ idx=Math.floor(Math.random()*variants.length);}while(usedVariants.includes(idx));
  usedVariants.push(idx);
  const chosen=variants[idx];
  info.textContent=`Variante ${usedVariants.length}/${variants.length}`;

  sampleStats={paragraph:0,linebreak:0,tab:0,space:0,nbsp:0};
  const parts=[];
  for(const ch of chosen){
    if(ch==='·'){parts.push('<span class="mark space">·</span>');sampleStats.space++;}
    else if(ch==='°'){parts.push('<span class="mark nbsp">°</span>');sampleStats.nbsp++;}
    else if(ch==='→'){parts.push('<span class="mark tab">→</span>');sampleStats.tab++;}
    else if(ch==='¶'){parts.push('<span class="mark paragraph">¶</span>');sampleStats.paragraph++;}
    else if(ch==='↵'){parts.push('<span class="mark linebreak">↵</span>');sampleStats.linebreak++;parts.push('<br>');}
    else{parts.push(ch);}
  }
  sample.innerHTML=parts.join('');
}
document.getElementById('regen').onclick=()=>{randomSample();};
randomSample();

document.getElementById('check3').onclick=()=>{
  const ans={
    paragraph:+document.getElementById('q_paragraph').value||0,
    linebreak:+document.getElementById('q_linebreak').value||0,
    tab:+document.getElementById('q_tab').value||0,
    space:+document.getElementById('q_space').value||0,
    nbsp:+document.getElementById('q_nbsp').value||0
  };
  let ok=0; ok+=(ans.paragraph===sampleStats.paragraph);
  ok+=(ans.linebreak===sampleStats.linebreak);
  ok+=(ans.tab===sampleStats.tab);
  ok+=(ans.space===sampleStats.space);
  ok+=(ans.nbsp===sampleStats.nbsp);
  const r=document.getElementById('result3');
  r.textContent=ok===5?`Bravo (${ok}/5)`:`${ok}/5 correct`;
  r.style.color=ok===5?'var(--ok)':'var(--ko)';
};
</script>
</body>
</html>
